<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<link rel="alternate" type="application/rss+xml" href="/en/blog/rss.xml" title="go-zero RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/en/blog/atom.xml" title="go-zero Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="go-zero" href="/en/opensearch.xml"><title data-react-helmet="true">Highly Concurrent Microservices | go-zero</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://zeromicro.github.io/en/docs/extension/shorturl"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Highly Concurrent Microservices | go-zero"><meta data-react-helmet="true" name="description" content="ä¸ºä»€ä¹ˆè¯´åšå¥½å¾®æœåŠ¡å¾ˆéš¾"><meta data-react-helmet="true" property="og:description" content="ä¸ºä»€ä¹ˆè¯´åšå¥½å¾®æœåŠ¡å¾ˆéš¾"><link data-react-helmet="true" rel="icon" href="/en/img/go-zero.svg"><link data-react-helmet="true" rel="canonical" href="https://zeromicro.github.io/en/docs/extension/shorturl"><link data-react-helmet="true" rel="alternate" href="https://zeromicro.github.io/docs/extension/shorturl" hreflang="zh"><link data-react-helmet="true" rel="alternate" href="https://zeromicro.github.io/en/docs/extension/shorturl" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://zeromicro.github.io/docs/extension/shorturl" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/en/assets/css/styles.ebdda6f7.css">
<link rel="preload" href="/en/assets/js/runtime~main.e947d4da.js" as="script">
<link rel="preload" href="/en/assets/js/main.2f72096f.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/en/"><div class="navbar__logo"><img src="/en/img/go-zero.png" alt="Go-zero Logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/en/img/go-zero.png" alt="Go-zero Logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">Go-zero</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/en/docs/intro/brief">Docs</a><a class="navbar__item navbar__link" href="/en/blog">Blog</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" class="iconLanguage_EbrZ"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>English</span></span></a><ul class="dropdown__menu"><li><a href="/docs/extension/shorturl" target="_self" rel="noopener noreferrer" class="dropdown__link">ä¸­æ–‡</a></li><li><a href="/en/docs/extension/shorturl" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active">English</a></li></ul></div><a href="https://github.com/zeromicro/go-zero" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">ğŸŒœ</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">ğŸŒ</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div><div class="searchBox_Utm0"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/en/docs/intro/brief">Introduction</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/en/docs/quick-start/concept">Quick Start</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/en/docs/build-tool/tool-intro">Build Tool</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/en/docs/component/rest">Components</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/en/docs/other-component/go-queue">Other Components</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/en/docs/project/prepare">Project</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/en/docs/ecology/intellij">Ecology</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_TwRn" href="/en/docs/extension/shorturl">Extension</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/en/docs/extension/shorturl">Highly Concurrent Microservices</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/extension/logx">Logx</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/extension/bloom">Bloom filter</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/extension/executors">Executors</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/extension/fx">Fx</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/extension/mysql">Mysql</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/extension/redis-lock">Redis Lock</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/extension/periodlimit">Periodlimit</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/extension/tokenlimit">Tokenlimit</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/extension/timing-wheel">Timingwheel</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/extension/collection">Collection Cache</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/extension/keywords">Sensitive word filtering tool</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/extension/mapping">Serialization</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/extension/mapreduce">MapReduce</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/extension/metric">Metric</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/extension/sharedcalls">SharedCalls</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/extension/sql-cache">DB Cache</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/extension/zrpc">zRPC</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/extension/redis-cache">Cache</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/extension/buiness-cache">Business Cache</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/extension/go-queue">Go-queue</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/extension/go-zero-looklook">Looklook</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/extension/datacenter">Datacenter</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/extension/stream">Stream</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/en/docs/problem/in-use">Problems</a></div></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Highly Concurrent Microservices</h1></header><h2 class="anchor anchorWithStickyNavbar_y2LR" id="ä¸ºä»€ä¹ˆè¯´åšå¥½å¾®æœåŠ¡å¾ˆéš¾">ä¸ºä»€ä¹ˆè¯´åšå¥½å¾®æœåŠ¡å¾ˆéš¾<a class="hash-link" href="#ä¸ºä»€ä¹ˆè¯´åšå¥½å¾®æœåŠ¡å¾ˆéš¾" title="Direct link to heading">â€‹</a></h2><p>è¦æƒ³åšå¥½å¾®æœåŠ¡ï¼Œæˆ‘ä»¬éœ€è¦ç†è§£å’ŒæŒæ¡çš„çŸ¥è¯†ç‚¹éå¸¸å¤šï¼Œä»å‡ ä¸ªç»´åº¦ä¸Šæ¥è¯´ï¼š</p><ul><li><p>åŸºæœ¬åŠŸèƒ½å±‚é¢</p><ol><li>å¹¶å‘æ§åˆ¶ &amp; é™æµï¼Œé¿å…æœåŠ¡è¢«çªå‘æµé‡å‡»å®</li><li>æœåŠ¡æ³¨å†Œä¸æœåŠ¡å‘ç°ï¼Œç¡®ä¿èƒ½å¤ŸåŠ¨æ€ä¾¦æµ‹å¢å‡çš„èŠ‚ç‚¹</li><li>è´Ÿè½½å‡è¡¡ï¼Œéœ€è¦æ ¹æ®èŠ‚ç‚¹æ‰¿å—èƒ½åŠ›åˆ†å‘æµé‡</li><li>è¶…æ—¶æ§åˆ¶ï¼Œé¿å…å¯¹å·²è¶…æ—¶è¯·æ±‚åšæ— ç”¨åŠŸ</li><li>ç†”æ–­è®¾è®¡ï¼Œå¿«é€Ÿå¤±è´¥ï¼Œä¿éšœæ•…éšœèŠ‚ç‚¹çš„æ¢å¤èƒ½åŠ›</li></ol></li><li><p>é«˜é˜¶åŠŸèƒ½å±‚é¢</p><ol><li>è¯·æ±‚è®¤è¯ï¼Œç¡®ä¿æ¯ä¸ªç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„æ•°æ®</li><li>é“¾è·¯è¿½è¸ªï¼Œç”¨äºç†è§£æ•´ä¸ªç³»ç»Ÿå’Œå¿«é€Ÿå®šä½ç‰¹å®šè¯·æ±‚çš„é—®é¢˜</li><li>æ—¥å¿—ï¼Œç”¨äºæ•°æ®æ”¶é›†å’Œé—®é¢˜å®šä½</li><li>å¯è§‚æµ‹æ€§ï¼Œæ²¡æœ‰åº¦é‡å°±æ²¡æœ‰ä¼˜åŒ–</li></ol></li></ul><p>å¯¹äºå…¶ä¸­æ¯ä¸€ç‚¹ï¼Œæˆ‘ä»¬éƒ½éœ€è¦ç”¨å¾ˆé•¿çš„ç¯‡å¹…æ¥è®²è¿°å…¶åŸç†å’Œå®ç°ï¼Œé‚£ä¹ˆå¯¹æˆ‘ä»¬åç«¯å¼€å‘è€…æ¥è¯´ï¼Œè¦æƒ³æŠŠè¿™äº›çŸ¥è¯†ç‚¹éƒ½æŒæ¡å¹¶è½å®åˆ°ä¸šåŠ¡ç³»ç»Ÿé‡Œï¼Œéš¾åº¦æ˜¯éå¸¸å¤§çš„ï¼Œä¸è¿‡æˆ‘ä»¬å¯ä»¥ä¾èµ–å·²ç»è¢«å¤§æµé‡éªŒè¯è¿‡çš„æ¡†æ¶ä½“ç³»ã€‚<a href="https://github.com/zeromicro/go-zero" target="_blank" rel="noopener noreferrer">go-zero å¾®æœåŠ¡æ¡†æ¶</a>å°±æ˜¯ä¸ºæ­¤è€Œç”Ÿã€‚</p><p>å¦å¤–ï¼Œæˆ‘ä»¬å§‹ç»ˆç§‰æ‰¿ <strong>å·¥å…·å¤§äºçº¦å®šå’Œæ–‡æ¡£</strong> çš„ç†å¿µã€‚æˆ‘ä»¬å¸Œæœ›å°½å¯èƒ½å‡å°‘å¼€å‘äººå‘˜çš„å¿ƒæ™ºè´Ÿæ‹…ï¼ŒæŠŠç²¾åŠ›éƒ½æŠ•å…¥åˆ°äº§ç”Ÿä¸šåŠ¡ä»·å€¼çš„ä»£ç ä¸Šï¼Œå‡å°‘é‡å¤ä»£ç çš„ç¼–å†™ï¼Œæ‰€ä»¥æˆ‘ä»¬å¼€å‘äº† <code>goctl</code> å·¥å…·ã€‚</p><p>ä¸‹é¢æˆ‘é€šè¿‡çŸ­é“¾å¾®æœåŠ¡æ¥æ¼”ç¤ºé€šè¿‡ <a href="https://github.com/zeromicro/go-zero" target="_blank" rel="noopener noreferrer">go-zero</a> å¿«é€Ÿçš„åˆ›å»ºå¾®æœåŠ¡çš„æµç¨‹ï¼Œèµ°å®Œä¸€éï¼Œä½ å°±ä¼šå‘ç°ï¼šåŸæ¥ç¼–å†™å¾®æœåŠ¡å¦‚æ­¤ç®€å•ï¼</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="ä»€ä¹ˆæ˜¯çŸ­é“¾æœåŠ¡">ä»€ä¹ˆæ˜¯çŸ­é“¾æœåŠ¡<a class="hash-link" href="#ä»€ä¹ˆæ˜¯çŸ­é“¾æœåŠ¡" title="Direct link to heading">â€‹</a></h2><p>çŸ­é“¾æœåŠ¡å°±æ˜¯å°†é•¿çš„ URL ç½‘å€ï¼Œé€šè¿‡ç¨‹åºè®¡ç®—ç­‰æ–¹å¼ï¼Œè½¬æ¢ä¸ºç®€çŸ­çš„ç½‘å€å­—ç¬¦ä¸²ã€‚</p><p>å†™æ­¤çŸ­é“¾æœåŠ¡æ˜¯ä¸ºäº†ä»æ•´ä½“ä¸Šæ¼”ç¤º go-zero æ„å»ºå®Œæ•´å¾®æœåŠ¡çš„è¿‡ç¨‹ï¼Œç®—æ³•å’Œå®ç°ç»†èŠ‚å°½å¯èƒ½ç®€åŒ–äº†ï¼Œæ‰€ä»¥è¿™ä¸æ˜¯ä¸€ä¸ªé«˜é˜¶çš„çŸ­é“¾æœåŠ¡ã€‚</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="çŸ­é“¾å¾®æœåŠ¡æ¶æ„å›¾">çŸ­é“¾å¾®æœåŠ¡æ¶æ„å›¾<a class="hash-link" href="#çŸ­é“¾å¾®æœåŠ¡æ¶æ„å›¾" title="Direct link to heading">â€‹</a></h2><img src="https://raw.githubusercontent.com/zeromicro/zero-doc/main/doc/images/shorturl-arch.png" alt="æ¶æ„å›¾" width="800"><ul><li>è¿™é‡Œåªç”¨äº† <code>Transform RPC</code> ä¸€ä¸ªå¾®æœåŠ¡ï¼Œå¹¶ä¸æ˜¯è¯´ API Gateway åªèƒ½è°ƒç”¨ä¸€ä¸ªå¾®æœåŠ¡ï¼Œåªæ˜¯ä¸ºäº†æœ€ç®€æ¼”ç¤º API Gateway å¦‚ä½•è°ƒç”¨ RPC å¾®æœåŠ¡è€Œå·²</li><li>åœ¨çœŸæ­£é¡¹ç›®é‡Œè¦å°½å¯èƒ½æ¯ä¸ªå¾®æœåŠ¡ä½¿ç”¨è‡ªå·±çš„æ•°æ®åº“ï¼Œæ•°æ®è¾¹ç•Œè¦æ¸…æ™°</li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="goctl-å„å±‚ä»£ç ç”Ÿæˆä¸€è§ˆ">goctl å„å±‚ä»£ç ç”Ÿæˆä¸€è§ˆ<a class="hash-link" href="#goctl-å„å±‚ä»£ç ç”Ÿæˆä¸€è§ˆ" title="Direct link to heading">â€‹</a></h2><p>æ‰€æœ‰ç»¿è‰²èƒŒæ™¯çš„åŠŸèƒ½æ¨¡å—æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„ï¼ŒæŒ‰éœ€æ¿€æ´»ï¼Œçº¢è‰²æ¨¡å—æ˜¯éœ€è¦è‡ªå·±å†™çš„ï¼Œä¹Ÿå°±æ˜¯å¢åŠ ä¸‹ä¾èµ–ï¼Œç¼–å†™ä¸šåŠ¡ç‰¹æœ‰é€»è¾‘ï¼Œå„å±‚ç¤ºæ„å›¾åˆ†åˆ«å¦‚ä¸‹ï¼š</p><ul><li><p>API Gateway</p><img src="https://raw.githubusercontent.com/zeromicro/zero-doc/main/doc/images/shorturl-api.png" alt="api" width="800"></li><li><p>RPC</p><img src="https://raw.githubusercontent.com/zeromicro/zero-doc/main/doc/images/shorturl-rpc.png" alt="æ¶æ„å›¾" width="800"></li><li><p>model</p><img src="https://raw.githubusercontent.com/zeromicro/zero-doc/main/doc/images/shorturl-model.png" alt="model" width="800"></li></ul><p>ä¸‹é¢æˆ‘ä»¬æ¥ä¸€èµ·å®Œæ•´èµ°ä¸€éå¿«é€Ÿæ„å»ºå¾®æœåŠ¡çš„æµç¨‹ï¼ŒLetâ€™s <code>Go</code>!ğŸƒâ€â™‚ï¸</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="å‡†å¤‡å·¥ä½œ">å‡†å¤‡å·¥ä½œ<a class="hash-link" href="#å‡†å¤‡å·¥ä½œ" title="Direct link to heading">â€‹</a></h2><ul><li><p>å®‰è£… etcd, mysql, redis</p></li><li><p>å®‰è£… <code>protoc-gen-go</code></p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">go get -u github.com/golang/protobuf/protoc-gen-go@v1.3.2</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>å®‰è£… <code>protoc</code></p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">wget</span><span class="token plain"> https://github.com/protocolbuffers/protobuf/releases/download/v3.14.0/protoc-3.14.0-linux-x86_64.zip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">unzip</span><span class="token plain"> protoc-3.14.0-linux-x86_64.zip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">mv</span><span class="token plain"> bin/protoc /usr/local/bin/</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>å®‰è£… goctl å·¥å…·</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token assign-left variable" style="color:#36acaa">GO111MODULE</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">on </span><span class="token assign-left variable" style="color:#36acaa">GOPROXY</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">https://goproxy.cn/,direct go get -u github.com/zeromicro/go-zero/tools/goctl</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>åˆ›å»ºå·¥ä½œç›®å½• <code>shorturl</code> å’Œ <code>shorturl/api</code></p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p shorturl/api</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>åœ¨ <code>shorturl</code> ç›®å½•ä¸‹æ‰§è¡Œ <code>go mod init shorturl</code> åˆå§‹åŒ– <code>go.mod</code></p><div class="codeBlockContainer_J+bg language-Plain theme-code-block"><div class="codeBlockContent_csEI Plain"><pre tabindex="0" class="prism-code language-Plain codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">module shorturl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">go 1.15</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">require (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  github.com/golang/mock v1.4.3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  github.com/golang/protobuf v1.4.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  github.com/zeromicro/go-zero v1.3.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  golang.org/x/net v0.0.0-20200707034311-ab3426394381</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  google.golang.org/grpc v1.29.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><strong>æ³¨æ„ï¼šè¿™é‡Œå¯èƒ½å­˜åœ¨ grpc ç‰ˆæœ¬ä¾èµ–çš„é—®é¢˜ï¼Œå¯ä»¥ç”¨ä»¥ä¸Šé…ç½®</strong></p></li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="ç¼–å†™-api-gateway-ä»£ç ">ç¼–å†™ API Gateway ä»£ç <a class="hash-link" href="#ç¼–å†™-api-gateway-ä»£ç " title="Direct link to heading">â€‹</a></h2><ul><li><p>åœ¨ <code>shorturl/api</code> ç›®å½•ä¸‹é€šè¿‡ goctl ç”Ÿæˆ <code>api/shorturl.api</code>ï¼š</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">goctl api -o shorturl.api</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>ç¼–è¾‘ <code>api/shorturl.api</code>ï¼Œä¸ºäº†ç®€æ´ï¼Œå»é™¤äº†æ–‡ä»¶å¼€å¤´çš„ <code>info</code>ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_J+bg language-go theme-code-block"><div class="codeBlockContent_csEI go"><pre tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  expandReq </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    shorten </span><span class="token builtin">string</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">`form:&quot;shorten&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  expandResp </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    url </span><span class="token builtin">string</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">`json:&quot;url&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  shortenReq </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    url </span><span class="token builtin">string</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">`form:&quot;url&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  shortenResp </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    shorten </span><span class="token builtin">string</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">`json:&quot;shorten&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service shorturl</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">api </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @</span><span class="token function" style="color:#d73a49">server</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    handler</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ShortenHandler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  get </span><span class="token operator" style="color:#393A34">/</span><span class="token function" style="color:#d73a49">shorten</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">shortenReq</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">returns</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">shortenResp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @</span><span class="token function" style="color:#d73a49">server</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    handler</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ExpandHandler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  get </span><span class="token operator" style="color:#393A34">/</span><span class="token function" style="color:#d73a49">expand</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">expandReq</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">returns</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">expandResp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>type ç”¨æ³•å’Œ go ä¸€è‡´ï¼Œservice ç”¨æ¥å®šä¹‰ get/post/head/delete ç­‰ api è¯·æ±‚ï¼Œè§£é‡Šå¦‚ä¸‹ï¼š</p><ul><li><code>service shorturl-api {</code> è¿™ä¸€è¡Œå®šä¹‰äº† service åå­—</li><li><code>@server</code> éƒ¨åˆ†ç”¨æ¥å®šä¹‰ server ç«¯ç”¨åˆ°çš„å±æ€§</li><li><code>handler</code> å®šä¹‰äº†æœåŠ¡ç«¯ handler åå­—</li><li><code>get /shorten(shortenReq) returns(shortenResp)</code> å®šä¹‰äº† get æ–¹æ³•çš„è·¯ç”±ã€è¯·æ±‚å‚æ•°ã€è¿”å›å‚æ•°ç­‰</li></ul></li><li><p>ä½¿ç”¨ goctl ç”Ÿæˆ API Gateway ä»£ç </p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">goctl api go -api shorturl.api -dir </span><span class="token builtin class-name">.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>ç”Ÿæˆçš„æ–‡ä»¶ç»“æ„å¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_J+bg language-Plain theme-code-block"><div class="codeBlockContent_csEI Plain"><pre tabindex="0" class="prism-code language-Plain codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€â”€ api</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   â”œâ”€â”€ etc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   â”‚   â””â”€â”€ shorturl-api.yaml         // é…ç½®æ–‡ä»¶</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   â”œâ”€â”€ internal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   â”‚   â”œâ”€â”€ config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   â”‚   â”‚   â””â”€â”€ config.go             // å®šä¹‰é…ç½®</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   â”‚   â”œâ”€â”€ handler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   â”‚   â”‚   â”œâ”€â”€ expandhandler.go      // å®ç° expandHandler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   â”‚   â”‚   â”œâ”€â”€ routes.go             // å®šä¹‰è·¯ç”±å¤„ç†</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   â”‚   â”‚   â””â”€â”€ shortenhandler.go     // å®ç° shortenHandler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   â”‚   â”œâ”€â”€ logic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   â”‚   â”‚   â”œâ”€â”€ expandlogic.go        // å®ç° ExpandLogic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   â”‚   â”‚   â””â”€â”€ shortenlogic.go       // å®ç° ShortenLogic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   â”‚   â”œâ”€â”€ svc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   â”‚   â”‚   â””â”€â”€ servicecontext.go     // å®šä¹‰ ServiceContext</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   â”‚   â””â”€â”€ types</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   â”‚       â””â”€â”€ types.go              // å®šä¹‰è¯·æ±‚ã€è¿”å›ç»“æ„ä½“</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   â”œâ”€â”€ shorturl.api</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   â””â”€â”€ shorturl.go                   // main å…¥å£å®šä¹‰</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€â”€ go.mod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â””â”€â”€ go.sum</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>å¯åŠ¨ API Gateway æœåŠ¡ï¼Œé»˜è®¤ä¾¦å¬åœ¨ 8888 ç«¯å£</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">go run shorturl.go -f etc/shorturl-api.yaml</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>æµ‹è¯• API Gateway æœåŠ¡</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -i </span><span class="token string" style="color:#e3116c">&quot;http://localhost:8888/shorten?url=http://www.xiaoheiban.cn&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>è¿”å›å¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_J+bg language-http theme-code-block"><div class="codeBlockContent_csEI http"><pre tabindex="0" class="prism-code language-http codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">HTTP/1.1 200 OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Type: application/json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Date: Thu, 27 Aug 2020 14:31:39 GMT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Length: 15</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{&quot;shorten&quot;:&quot;&quot;}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬ API Gateway å…¶å®å•¥ä¹Ÿæ²¡å¹²ï¼Œå°±è¿”å›äº†ä¸ªç©ºå€¼ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä¼šåœ¨ rpc æœåŠ¡é‡Œå®ç°ä¸šåŠ¡é€»è¾‘</p></li><li><p>å¯ä»¥ä¿®æ”¹ <code>internal/svc/servicecontext.go</code> æ¥ä¼ é€’æœåŠ¡ä¾èµ–ï¼ˆå¦‚æœéœ€è¦ï¼‰</p></li><li><p>å®ç°é€»è¾‘å¯ä»¥ä¿®æ”¹ <code>internal/logic</code> ä¸‹çš„å¯¹åº”æ–‡ä»¶</p></li><li><p>å¯ä»¥é€šè¿‡ <code>goctl</code> ç”Ÿæˆå„ç§å®¢æˆ·ç«¯è¯­è¨€çš„ api è°ƒç”¨ä»£ç </p></li><li><p>åˆ°è¿™é‡Œï¼Œä½ å·²ç»å¯ä»¥é€šè¿‡ goctl ç”Ÿæˆå®¢æˆ·ç«¯ä»£ç ç»™å®¢æˆ·ç«¯åŒå­¦å¹¶è¡Œå¼€å‘äº†ï¼Œæ”¯æŒå¤šç§è¯­è¨€ï¼Œè¯¦è§æ–‡æ¡£</p></li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="ç¼–å†™-transform-rpc-æœåŠ¡">ç¼–å†™ transform rpc æœåŠ¡<a class="hash-link" href="#ç¼–å†™-transform-rpc-æœåŠ¡" title="Direct link to heading">â€‹</a></h2><ul><li>åœ¨ <code>shorturl</code> ç›®å½•ä¸‹åˆ›å»º <code>rpc</code> ç›®å½•</li></ul><ul><li><p>åœ¨ <code>rpc/transform</code> ç›®å½•ä¸‹ç¼–å†™ <code>transform.proto</code> æ–‡ä»¶</p><p>å¯ä»¥é€šè¿‡å‘½ä»¤ç”Ÿæˆ proto æ–‡ä»¶æ¨¡æ¿</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">goctl rpc template -o transform.proto</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>ä¿®æ”¹åæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_J+bg language-protobuf theme-code-block"><div class="codeBlockContent_csEI protobuf"><pre tabindex="0" class="prism-code language-protobuf codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">syntax = &quot;proto3&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">package transform;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message expandReq {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    string shorten = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message expandResp {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    string url = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message shortenReq {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    string url = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message shortenResp {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    string shorten = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service transformer {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rpc expand(expandReq) returns(expandResp);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rpc shorten(shortenReq) returns(shortenResp);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>ç”¨ <code>goctl</code> ç”Ÿæˆ rpc ä»£ç ï¼Œåœ¨ <code>rpc/transform</code> ç›®å½•ä¸‹æ‰§è¡Œå‘½ä»¤</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">goctl rpc proto -src transform.proto -dir </span><span class="token builtin class-name">.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><strong>æ³¨æ„ï¼šä¸èƒ½åœ¨ GOPATH ç›®å½•ä¸‹æ‰§è¡Œä»¥ä¸Šå‘½ä»¤</strong></p><p>æ–‡ä»¶ç»“æ„å¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_J+bg language-Plain theme-code-block"><div class="codeBlockContent_csEI Plain"><pre tabindex="0" class="prism-code language-Plain codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">rpc/transform</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€â”€ etc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   â””â”€â”€ transform.yaml              // é…ç½®æ–‡ä»¶</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€â”€ internal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   â”œâ”€â”€ config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   â”‚   â””â”€â”€ config.go               // é…ç½®å®šä¹‰</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   â”œâ”€â”€ logic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   â”‚   â”œâ”€â”€ expandlogic.go          // expand ä¸šåŠ¡é€»è¾‘åœ¨è¿™é‡Œå®ç°</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   â”‚   â””â”€â”€ shortenlogic.go         // shorten ä¸šåŠ¡é€»è¾‘åœ¨è¿™é‡Œå®ç°</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   â”œâ”€â”€ server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   â”‚   â””â”€â”€ transformerserver.go    // è°ƒç”¨å…¥å£, ä¸éœ€è¦ä¿®æ”¹</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   â””â”€â”€ svc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚       â””â”€â”€ servicecontext.go       // å®šä¹‰ ServiceContextï¼Œä¼ é€’ä¾èµ–</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€â”€ pb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   â””â”€â”€ transform.pb.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€â”€ transform.go                    // rpc æœåŠ¡ main å‡½æ•°</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€â”€ transform.proto</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â””â”€â”€ transformer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    â”œâ”€â”€ transformer.go              // æä¾›äº†å¤–éƒ¨è°ƒç”¨æ–¹æ³•ï¼Œæ— éœ€ä¿®æ”¹</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    â”œâ”€â”€ transformer_mock.go         // mock æ–¹æ³•ï¼Œæµ‹è¯•ç”¨</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    â””â”€â”€ types.go                    // request/response ç»“æ„ä½“å®šä¹‰</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>ç›´æ¥å¯ä»¥è¿è¡Œï¼Œå¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">$ go run transform.go -f etc/transform.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Starting rpc server at </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:8080</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>æŸ¥çœ‹æœåŠ¡æ˜¯å¦æ³¨å†Œ</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">$ETCDCTL_API=3 etcdctl get transform.rpc --prefix</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">transform.rpc/7587851893787585061</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">127.0.0.1:8080</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><code>etc/transform.yaml</code> æ–‡ä»¶é‡Œå¯ä»¥ä¿®æ”¹ä¾¦å¬ç«¯å£ç­‰é…ç½®</p></li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="ä¿®æ”¹-api-gateway-ä»£ç è°ƒç”¨-transform-rpc-æœåŠ¡">ä¿®æ”¹ API Gateway ä»£ç è°ƒç”¨ transform rpc æœåŠ¡<a class="hash-link" href="#ä¿®æ”¹-api-gateway-ä»£ç è°ƒç”¨-transform-rpc-æœåŠ¡" title="Direct link to heading">â€‹</a></h2><ul><li><p>ä¿®æ”¹é…ç½®æ–‡ä»¶ <code>shorturl-api.yaml</code>ï¼Œå¢åŠ å¦‚ä¸‹å†…å®¹</p><div class="codeBlockContainer_J+bg language-yaml theme-code-block"><div class="codeBlockContent_csEI yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">Transform</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">Etcd</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">Hosts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> localhost</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">2379</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">Key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> transform.rpc</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>é€šè¿‡ etcd è‡ªåŠ¨å»å‘ç°å¯ç”¨çš„ transform æœåŠ¡</p></li><li><p>ä¿®æ”¹ <code>internal/config/config.go</code> å¦‚ä¸‹ï¼Œå¢åŠ  transform æœåŠ¡ä¾èµ–</p><div class="codeBlockContainer_J+bg language-go theme-code-block"><div class="codeBlockContent_csEI go"><pre tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> Config </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rest</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">RestConf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Transform zrpc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">RpcClientConf     </span><span class="token comment" style="color:#999988;font-style:italic">// æ‰‹åŠ¨ä»£ç </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>ä¿®æ”¹ <code>internal/svc/servicecontext.go</code>ï¼Œå¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_J+bg language-go theme-code-block"><div class="codeBlockContent_csEI go"><pre tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> ServiceContext </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Config    config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Transformer transformer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Transformer                                          </span><span class="token comment" style="color:#999988;font-style:italic">// æ‰‹åŠ¨ä»£ç </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">NewServiceContext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Config</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">ServiceContext </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">ServiceContext</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">    c</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Transformer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> transformer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NewTransformer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">zrpc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">MustNewClient</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Transform</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// æ‰‹åŠ¨ä»£ç </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>é€šè¿‡ ServiceContext åœ¨ä¸åŒä¸šåŠ¡é€»è¾‘ä¹‹é—´ä¼ é€’ä¾èµ–</p></li><li><p>ä¿®æ”¹ <code>internal/logic/expandlogic.go</code> é‡Œçš„ <code>Expand</code> æ–¹æ³•ï¼Œå¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_J+bg language-go theme-code-block"><div class="codeBlockContent_csEI go"><pre tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">l </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">ExpandLogic</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Expand</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">req types</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ExpandReq</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">types</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ExpandResp</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// æ‰‹åŠ¨ä»£ç å¼€å§‹</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resp</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> l</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">svcCtx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Transformer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Expand</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">l</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">transformer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ExpandReq</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Shorten</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> req</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Shorten</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> types</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ExpandResp</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> types</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ExpandResp</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> resp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Url</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// æ‰‹åŠ¨ä»£ç ç»“æŸ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li></ul><p>é€šè¿‡è°ƒç”¨ <code>transformer</code> çš„ <code>Expand</code> æ–¹æ³•å®ç°çŸ­é“¾æ¢å¤åˆ° url</p><ul><li><p>ä¿®æ”¹ <code>internal/logic/shortenlogic.go</code>ï¼Œå¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_J+bg language-go theme-code-block"><div class="codeBlockContent_csEI go"><pre tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">l </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">ShortenLogic</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Shorten</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">req types</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ShortenReq</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">types</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ShortenResp</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// æ‰‹åŠ¨ä»£ç å¼€å§‹</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      resp</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> l</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">svcCtx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Transformer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Shorten</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">l</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">transformer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ShortenReq</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> req</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Url</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> types</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ShortenResp</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> types</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ShortenResp</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Shorten</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> resp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Shorten</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// æ‰‹åŠ¨ä»£ç ç»“æŸ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>æœ‰çš„ç‰ˆæœ¬ç”Ÿæˆè¿”å›å€¼å¯èƒ½æ˜¯æŒ‡é’ˆç±»å‹ï¼Œéœ€è¦è‡ªå·±è°ƒæ•´ä¸‹</p></li></ul><p>é€šè¿‡è°ƒç”¨ <code>transformer</code> çš„ <code>Shorten</code> æ–¹æ³•å®ç° url åˆ°çŸ­é“¾çš„å˜æ¢</p><p>è‡³æ­¤ï¼ŒAPI Gateway ä¿®æ”¹å®Œæˆï¼Œè™½ç„¶è´´çš„ä»£ç å¤šï¼Œä½†æ˜¯å…¶ä¸­ä¿®æ”¹çš„æ˜¯å¾ˆå°‘çš„ä¸€éƒ¨åˆ†ï¼Œä¸ºäº†æ–¹ä¾¿ç†è§£ä¸Šä¸‹æ–‡ï¼Œæˆ‘è´´äº†å®Œæ•´ä»£ç ï¼Œæ¥ä¸‹æ¥å¤„ç† CRUD+cache</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="å®šä¹‰æ•°æ®åº“è¡¨ç»“æ„å¹¶ç”Ÿæˆ-crudcache-ä»£ç ">å®šä¹‰æ•°æ®åº“è¡¨ç»“æ„ï¼Œå¹¶ç”Ÿæˆ CRUD+cache ä»£ç <a class="hash-link" href="#å®šä¹‰æ•°æ®åº“è¡¨ç»“æ„å¹¶ç”Ÿæˆ-crudcache-ä»£ç " title="Direct link to heading">â€‹</a></h2><ul><li><p>shorturl ä¸‹åˆ›å»º <code>rpc/transform/model</code> ç›®å½•ï¼š<code>mkdir -p rpc/transform/model</code></p></li><li><p>åœ¨ <code>rpc/transform/model</code> ç›®å½•ä¸‹ç¼–å†™åˆ›å»º shorturl è¡¨çš„ sql æ–‡ä»¶ <code>shorturl.sql</code>ï¼Œå¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_J+bg language-sql theme-code-block"><div class="codeBlockContent_csEI sql"><pre tabindex="0" class="prism-code language-sql codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">`</span><span class="token plain">shorturl</span><span class="token punctuation" style="color:#393A34">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">`</span><span class="token plain">shorten</span><span class="token punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">varchar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">255</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;shorten key&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">`</span><span class="token plain">url</span><span class="token punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">varchar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">255</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;original url&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">KEY</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">`</span><span class="token plain">shorten</span><span class="token punctuation" style="color:#393A34">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">ENGINE</span><span class="token operator" style="color:#393A34">=</span><span class="token keyword" style="color:#00009f">InnoDB</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DEFAULT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">CHARSET</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">utf8mb4</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>åˆ›å»º DB å’Œ table</p><div class="codeBlockContainer_J+bg language-sql theme-code-block"><div class="codeBlockContent_csEI sql"><pre tabindex="0" class="prism-code language-sql codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">create</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">database</span><span class="token plain"> gozero</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="codeBlockContainer_J+bg language-sql theme-code-block"><div class="codeBlockContent_csEI sql"><pre tabindex="0" class="prism-code language-sql codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">source shorturl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">sql</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>åœ¨ <code>rpc/transform/model</code> ç›®å½•ä¸‹æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ç”Ÿæˆ CRUD+cache ä»£ç ï¼Œ<code>-c</code> è¡¨ç¤ºä½¿ç”¨ <code>redis cache</code></p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">goctl model mysql ddl -c -src shorturl.sql -dir </span><span class="token builtin class-name">.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>ä¹Ÿå¯ä»¥ç”¨ <code>datasource</code> å‘½ä»¤ä»£æ›¿ <code>ddl</code> æ¥æŒ‡å®šæ•°æ®åº“é“¾æ¥ç›´æ¥ä» schema ç”Ÿæˆ</p><p>ç”Ÿæˆåçš„æ–‡ä»¶ç»“æ„å¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_J+bg language-Plain theme-code-block"><div class="codeBlockContent_csEI Plain"><pre tabindex="0" class="prism-code language-Plain codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">rpc/transform/model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€â”€ shorturl.sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€â”€ shorturlmodel.go              // CRUD+cache ä»£ç </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â””â”€â”€ vars.go                       // å®šä¹‰å¸¸é‡å’Œå˜é‡</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="ä¿®æ”¹-shortenexpand-rpc-ä»£ç è°ƒç”¨-crudcache-ä»£ç ">ä¿®æ”¹ shorten/expand rpc ä»£ç è°ƒç”¨ crud+cache ä»£ç <a class="hash-link" href="#ä¿®æ”¹-shortenexpand-rpc-ä»£ç è°ƒç”¨-crudcache-ä»£ç " title="Direct link to heading">â€‹</a></h2><ul><li><p>ä¿®æ”¹ <code>rpc/transform/etc/transform.yaml</code>ï¼Œå¢åŠ å¦‚ä¸‹å†…å®¹ï¼š</p><div class="codeBlockContainer_J+bg language-yaml theme-code-block"><div class="codeBlockContent_csEI yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">DataSource</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> root</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">password@tcp(localhost</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">3306)/gozero</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">Table</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> shorturl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">Cache</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">Host</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> localhost</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">6379</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>å¯ä»¥ä½¿ç”¨å¤šä¸ª redis ä½œä¸º cacheï¼Œæ”¯æŒ redis å•ç‚¹æˆ–è€… redis é›†ç¾¤</p></li><li><p>ä¿®æ”¹ <code>rpc/transform/internal/config/config.go</code>ï¼Œå¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_J+bg language-go theme-code-block"><div class="codeBlockContent_csEI go"><pre tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> Config </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  zrpc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">RpcServerConf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  DataSource </span><span class="token builtin">string</span><span class="token plain">             </span><span class="token comment" style="color:#999988;font-style:italic">// æ‰‹åŠ¨ä»£ç </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Table      </span><span class="token builtin">string</span><span class="token plain">             </span><span class="token comment" style="color:#999988;font-style:italic">// æ‰‹åŠ¨ä»£ç </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Cache      cache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CacheConf    </span><span class="token comment" style="color:#999988;font-style:italic">// æ‰‹åŠ¨ä»£ç </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>å¢åŠ äº† mysql å’Œ redis cache é…ç½®</p></li><li><p>ä¿®æ”¹ <code>rpc/transform/internal/svc/servicecontext.go</code>ï¼Œå¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_J+bg language-go theme-code-block"><div class="codeBlockContent_csEI go"><pre tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> ServiceContext </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  c     config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Model model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ShorturlModel   </span><span class="token comment" style="color:#999988;font-style:italic">// æ‰‹åŠ¨ä»£ç </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">NewServiceContext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Config</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">ServiceContext </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">ServiceContext</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    c</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">             c</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Model</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NewShorturlModel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sqlx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NewMysql</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DataSource</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Cache</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// æ‰‹åŠ¨ä»£ç </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>ä¿®æ”¹ <code>rpc/transform/internal/logic/expandlogic.go</code>ï¼Œå¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_J+bg language-go theme-code-block"><div class="codeBlockContent_csEI go"><pre tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">l </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">ExpandLogic</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Expand</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">in </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">transform</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ExpandReq</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">transform</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ExpandResp</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// æ‰‹åŠ¨ä»£ç å¼€å§‹</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  res</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> l</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">svcCtx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">FindOne</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">in</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Shorten</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">transform</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ExpandResp</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Url</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// æ‰‹åŠ¨ä»£ç ç»“æŸ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>ä¿®æ”¹ <code>rpc/transform/internal/logic/shortenlogic.go</code>ï¼Œå¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_J+bg language-go theme-code-block"><div class="codeBlockContent_csEI go"><pre tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">l </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">ShortenLogic</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Shorten</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">in </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">transform</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ShortenReq</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">transform</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ShortenResp</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// æ‰‹åŠ¨ä»£ç å¼€å§‹ï¼Œç”ŸæˆçŸ­é“¾æ¥</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  key </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> hash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Md5Hex</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token function" style="color:#d73a49">byte</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">in</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Url</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token boolean" style="color:#36acaa">_</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> l</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">svcCtx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Insert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Shorturl</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Shorten</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">     in</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Url</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">transform</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ShortenResp</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Shorten</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// æ‰‹åŠ¨ä»£ç ç»“æŸ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>è‡³æ­¤ä»£ç ä¿®æ”¹å®Œæˆï¼Œå‡¡æ˜¯æ‰‹åŠ¨ä¿®æ”¹çš„ä»£ç æˆ‘åŠ äº†æ ‡æ³¨</p><p><strong>æ³¨æ„ï¼š</strong></p><ol><li>undefined cacheï¼Œä½ éœ€è¦ <code>import &quot;github.com/zeromicro/go-zero/core/stores/cache&quot;</code></li><li>undefined model, sqlx, hash ç­‰ï¼Œä½ éœ€è¦åœ¨æ–‡ä»¶ä¸­</li></ol><div class="codeBlockContainer_J+bg language-golang theme-code-block"><div class="codeBlockContent_csEI golang"><pre tabindex="0" class="prism-code language-golang codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">import &quot;shorturl/rpc/transform/model&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import &quot;github.com/zeromicro/go-zero/core/stores/sqlx&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="å®Œæ•´è°ƒç”¨æ¼”ç¤º">å®Œæ•´è°ƒç”¨æ¼”ç¤º<a class="hash-link" href="#å®Œæ•´è°ƒç”¨æ¼”ç¤º" title="Direct link to heading">â€‹</a></h2><ul><li><p>shorten api è°ƒç”¨</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -i </span><span class="token string" style="color:#e3116c">&quot;http://localhost:8888/shorten?url=http://www.xiaoheiban.cn&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>è¿”å›å¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_J+bg language-http theme-code-block"><div class="codeBlockContent_csEI http"><pre tabindex="0" class="prism-code language-http codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">HTTP/1.1 200 OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Type: application/json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Date: Sat, 29 Aug 2020 10:49:49 GMT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Length: 21</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{&quot;shorten&quot;:&quot;f35b2a&quot;}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>expand api è°ƒç”¨</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -i </span><span class="token string" style="color:#e3116c">&quot;http://localhost:8888/expand?shorten=f35b2a&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>è¿”å›å¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_J+bg language-http theme-code-block"><div class="codeBlockContent_csEI http"><pre tabindex="0" class="prism-code language-http codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">HTTP/1.1 200 OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Type: application/json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Date: Sat, 29 Aug 2020 10:51:53 GMT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Length: 34</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{&quot;url&quot;:&quot;http://www.xiaoheiban.cn&quot;}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="benchmark">Benchmark<a class="hash-link" href="#benchmark" title="Direct link to heading">â€‹</a></h2><p>å› ä¸ºå†™å…¥ä¾èµ–äº mysql çš„å†™å…¥é€Ÿåº¦ï¼Œå°±ç›¸å½“äºå‹ mysql äº†ï¼Œæ‰€ä»¥å‹æµ‹åªæµ‹è¯•äº† expand æ¥å£ï¼Œç›¸å½“äºä» mysql é‡Œè¯»å–å¹¶åˆ©ç”¨ç¼“å­˜ï¼Œshorten.lua é‡Œéšæœºä» db é‡Œè·å–äº† 100 ä¸ªçƒ­ key æ¥ç”Ÿæˆå‹æµ‹è¯·æ±‚</p><p><img src="https://raw.githubusercontent.com/zeromicro/zero-doc/main/doc/images/shorturl-benchmark.png" alt="Benchmark"></p><p>å¯ä»¥çœ‹å‡ºåœ¨æˆ‘çš„ MacBook Pro ä¸Šèƒ½è¾¾åˆ° 3 ä¸‡ + çš„ qpsã€‚</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="å®Œæ•´ä»£ç ">å®Œæ•´ä»£ç <a class="hash-link" href="#å®Œæ•´ä»£ç " title="Direct link to heading">â€‹</a></h2><p><a href="https://github.com/zeromicro/zero-examples/tree/main/shorturl" target="_blank" rel="noopener noreferrer">https://github.com/zeromicro/zero-examples/tree/main/shorturl</a></p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="æ€»ç»“">æ€»ç»“<a class="hash-link" href="#æ€»ç»“" title="Direct link to heading">â€‹</a></h2><p>æˆ‘ä»¬ä¸€ç›´å¼ºè°ƒ <strong>å·¥å…·å¤§äºçº¦å®šå’Œæ–‡æ¡£</strong>ã€‚</p><p>go-zero ä¸åªæ˜¯ä¸€ä¸ªæ¡†æ¶ï¼Œæ›´æ˜¯ä¸€ä¸ªå»ºç«‹åœ¨æ¡†æ¶ + å·¥å…·åŸºç¡€ä¸Šçš„ï¼Œç®€åŒ–å’Œè§„èŒƒäº†æ•´ä¸ªå¾®æœåŠ¡æ„å»ºçš„æŠ€æœ¯ä½“ç³»ã€‚</p><p>æˆ‘ä»¬åœ¨ä¿æŒç®€å•çš„åŒæ—¶ä¹Ÿå°½å¯èƒ½æŠŠå¾®æœåŠ¡æ²»ç†çš„å¤æ‚åº¦å°è£…åˆ°äº†æ¡†æ¶å†…éƒ¨ï¼Œæå¤§çš„é™ä½äº†å¼€å‘äººå‘˜çš„å¿ƒæ™ºè´Ÿæ‹…ï¼Œä½¿å¾—ä¸šåŠ¡å¼€å‘å¾—ä»¥å¿«é€Ÿæ¨è¿›ã€‚</p><p>é€šè¿‡ go-zero+goctl ç”Ÿæˆçš„ä»£ç ï¼ŒåŒ…å«äº†å¾®æœåŠ¡æ²»ç†çš„å„ç§ç»„ä»¶ï¼ŒåŒ…æ‹¬ï¼šå¹¶å‘æ§åˆ¶ã€è‡ªé€‚åº”ç†”æ–­ã€è‡ªé€‚åº”é™è½½ã€è‡ªåŠ¨ç¼“å­˜æ§åˆ¶ç­‰ï¼Œå¯ä»¥è½»æ¾éƒ¨ç½²ä»¥æ‰¿è½½å·¨å¤§è®¿é—®é‡ã€‚</p><p>æœ‰ä»»ä½•å¥½çš„æå‡å·¥ç¨‹æ•ˆç‡çš„æƒ³æ³•ï¼Œéšæ—¶æ¬¢è¿äº¤æµï¼ğŸ‘</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/zhoushuguang/zero-doc/tree/main/website/i18n/en/docusaurus-plugin-content-docs/current/extension/shorturl.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/en/docs/ecology/distributed-transaction"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Distributed Transaction Support</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/en/docs/extension/logx"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Logx</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#ä¸ºä»€ä¹ˆè¯´åšå¥½å¾®æœåŠ¡å¾ˆéš¾" class="table-of-contents__link toc-highlight">ä¸ºä»€ä¹ˆè¯´åšå¥½å¾®æœåŠ¡å¾ˆéš¾</a></li><li><a href="#ä»€ä¹ˆæ˜¯çŸ­é“¾æœåŠ¡" class="table-of-contents__link toc-highlight">ä»€ä¹ˆæ˜¯çŸ­é“¾æœåŠ¡</a></li><li><a href="#çŸ­é“¾å¾®æœåŠ¡æ¶æ„å›¾" class="table-of-contents__link toc-highlight">çŸ­é“¾å¾®æœåŠ¡æ¶æ„å›¾</a></li><li><a href="#goctl-å„å±‚ä»£ç ç”Ÿæˆä¸€è§ˆ" class="table-of-contents__link toc-highlight">goctl å„å±‚ä»£ç ç”Ÿæˆä¸€è§ˆ</a></li><li><a href="#å‡†å¤‡å·¥ä½œ" class="table-of-contents__link toc-highlight">å‡†å¤‡å·¥ä½œ</a></li><li><a href="#ç¼–å†™-api-gateway-ä»£ç " class="table-of-contents__link toc-highlight">ç¼–å†™ API Gateway ä»£ç </a></li><li><a href="#ç¼–å†™-transform-rpc-æœåŠ¡" class="table-of-contents__link toc-highlight">ç¼–å†™ transform rpc æœåŠ¡</a></li><li><a href="#ä¿®æ”¹-api-gateway-ä»£ç è°ƒç”¨-transform-rpc-æœåŠ¡" class="table-of-contents__link toc-highlight">ä¿®æ”¹ API Gateway ä»£ç è°ƒç”¨ transform rpc æœåŠ¡</a></li><li><a href="#å®šä¹‰æ•°æ®åº“è¡¨ç»“æ„å¹¶ç”Ÿæˆ-crudcache-ä»£ç " class="table-of-contents__link toc-highlight">å®šä¹‰æ•°æ®åº“è¡¨ç»“æ„ï¼Œå¹¶ç”Ÿæˆ CRUD+cache ä»£ç </a></li><li><a href="#ä¿®æ”¹-shortenexpand-rpc-ä»£ç è°ƒç”¨-crudcache-ä»£ç " class="table-of-contents__link toc-highlight">ä¿®æ”¹ shorten/expand rpc ä»£ç è°ƒç”¨ crud+cache ä»£ç </a></li><li><a href="#å®Œæ•´è°ƒç”¨æ¼”ç¤º" class="table-of-contents__link toc-highlight">å®Œæ•´è°ƒç”¨æ¼”ç¤º</a></li><li><a href="#benchmark" class="table-of-contents__link toc-highlight">Benchmark</a></li><li><a href="#å®Œæ•´ä»£ç " class="table-of-contents__link toc-highlight">å®Œæ•´ä»£ç </a></li><li><a href="#æ€»ç»“" class="table-of-contents__link toc-highlight">æ€»ç»“</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/en/docs/intro/brief">docs</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://join.slack.com/t/go-zero/shared_invite/zt-10ruju779-BE4y6lQNB_R21samtyKTgA" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Chat Group<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/en/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/zeromicro/go-zero" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 go-zero.dev, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/en/assets/js/runtime~main.e947d4da.js"></script>
<script src="/en/assets/js/main.2f72096f.js"></script>
</body>
</html>